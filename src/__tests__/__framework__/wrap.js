/**
 * @generated-from ./$wrap.js
 * This file is autogenerated from a template. Please do not edit it directly.
 * To rebuild it from its template use the command
 * > npm run generate
 * More information can be found in CONTRIBUTING.md
 */

/* eslint-disable no-unused-vars,import/no-duplicates,no-constant-condition */

const wrappedIterables = [];

class WrappedIterable {
  constructor(source) {
    this.source = source;
    this.done = false;
    this.started = false;
    this.returned = false;
  }

  next() {
    this.started = true;
    const item = this.source.next();
    if (item.done) this.done = true;
    return item;
  }

  return(value) {
    if (this.done) {
      throw new Error('Called return on an iterator that was done');
    }
    this.done = true;
    this.returned = true;
    return { value, done: true };
  }

  [Symbol.iterator]() {
    return this;
  }
}

export function wrap(iterable) {
  const getIterator = iterable[Symbol.iterator];
  const wrapped = new WrappedIterable(getIterator.call(iterable));
  wrappedIterables.push(wrapped);
  return wrapped;
}

beforeEach(() => {
  wrappedIterables.length = 0;
});

afterEach(() => {
  for (const wrapped of wrappedIterables) {
    if (wrapped.started && !(wrapped.done || wrapped.returned)) {
      throw new Error('Not all iterables returned');
    }
  }
});
